<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Real-time Crime News</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    :root{
      --bg:#eef3f6;
      --card:#ffffff;
      --muted:#666;
      --accent:#0b84ff;
      --hot:#b00020;
    }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg,#f5f8fa,#eef3f6);
      color:#0b1220;
    }

    .wrap{
      max-width:1100px;
      margin:20px auto;
      padding:14px;
      box-sizing:border-box;
    }

    h1.page-title{
      margin:8px 0 18px;
      font-size:24px;
      font-weight:700;
      color:#0b1220;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:14px;
    }

    .controls .btn{
      padding:8px 12px;
      border-radius:8px;
      border:0;
      background:var(--accent);
      color:white;
      font-weight:700;
      cursor:pointer;
    }

    .feed{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .card{
      background:var(--card);
      border-radius:12px;
      padding:14px;
      box-shadow:0 8px 28px rgba(12,24,40,0.06);
      display:block;
    }

    .meta{
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }

    .title{
      font-weight:700;
      margin-bottom:8px;
      font-size:16px;
      line-height:1.25;
    }

    .desc{
      color:#2a2a2a;
      margin-bottom:8px;
    }

    .readmore{
      font-size:14px;
    }

    .hotspot{
      color:var(--hot);
      font-weight:800;
      margin-left:8px;
    }

    /* small screens */
    @media(max-width:720px){
      .wrap{padding:12px}
      .title{font-size:15px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="page-title">Real-time Crime News</h1>

    <div class="controls">
      <button id="refreshBtn" class="btn">Refresh</button>
      <div style="color:var(--muted); font-size:13px;">Auto-refresh every 2 minutes</div>
    </div>

    <div class="feed" id="feed">
      <!-- news cards injected here -->
    </div>
  </div>

  <script>
    const feedEl = document.getElementById('feed');
    const refreshBtn = document.getElementById('refreshBtn');

    async function loadData(){
      try {
        const res = await fetch('/api/news');
        if(!res.ok){
          feedEl.innerHTML = '<div style="color:#b00">Failed to load news. Try refreshing the page.</div>';
          return;
        }
        const data = await res.json();

        if(!Array.isArray(data) || data.length === 0){
          feedEl.innerHTML = '<div style="color:#666">No news available right now.</div>';
          return;
        }

        feedEl.innerHTML = '';
        data.forEach(i => {
          const time = i.published_at ? new Date(i.published_at).toLocaleString() : '';
          const card = document.createElement('div');
          card.className = 'card';

          card.innerHTML = `
            <div class="meta">${i.source || ''} Â· ${time}</div>
            <div class="title">${i.title || 'No title'}</div>
            <div class="desc">${i.description ? (i.description.length > 320 ? i.description.slice(0,320) + '...' : i.description) : ''}</div>
            <div class="readmore">
              <a href="${i.url}" target="_blank" rel="noopener">Read more</a>
              ${i.is_hotspot ? '<span class="hotspot">HOTSPOT</span>' : ''}
            </div>
          `;

          feedEl.appendChild(card);
        });

      } catch (err) {
        console.error("loadData error:", err);
        feedEl.innerHTML = '<div style="color:#b00">An error occurred while loading news (check console).</div>';
      }
    }

    // manual refresh
    refreshBtn.addEventListener('click', () => {
      loadData();
    });

    // initial load + periodic refresh
    loadData();
    setInterval(loadData, 120000); // 2 minutes
  </script>
</body>
</html>
